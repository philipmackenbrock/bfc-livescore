<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.6">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!doctype html&gt;</p>
<p class="p1">&lt;html&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;meta charset="utf-8" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;meta name="viewport" content="width=device-width,initial-scale=1" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;title&gt;Live Ranking&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>:root{</p>
<p class="p1"><span class="Apple-converted-space">      </span>--bg:#f7fafc;</p>
<p class="p1"><span class="Apple-converted-space">      </span>--card:#fff;</p>
<p class="p1"><span class="Apple-converted-space">      </span>--muted:#555;</p>
<p class="p1"><span class="Apple-converted-space">      </span>--accent:#2c3e50;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:var(--bg); color:var(--accent); padding:24px; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>.leaderboard { max-width: 1000px; margin: 0 auto; background:var(--card); border-radius:12px; padding:18px; box-shadow:0 6px 20px rgba(0,0,0,0.06); overflow:hidden; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>h2 { margin:0 0 12px 0; font-weight:600; font-size:1.3rem; color:var(--accent); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>table { width:100%; border-collapse:collapse; table-layout:fixed; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>thead th { text-align:left; padding:10px 12px; font-weight:700; color:var(--muted); border-bottom:1px solid #eee; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>tbody td { padding:10px 12px; border-bottom:1px solid #f0f0f0; vertical-align:middle; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>.pos { width:56px; text-align:center; font-weight:700; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>.competitor { min-width:160px; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>.score { text-align:right; font-weight:700; width:110px; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>tbody tr { background:transparent; will-change: transform, opacity; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>/* highlight colors for rank change */</p>
<p class="p1"><span class="Apple-converted-space">    </span>.rank-up { box-shadow: inset 6px 0 0 rgba(40,167,69,0.12); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>.rank-down { box-shadow: inset 6px 0 0 rgba(220,53,69,0.12); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>/* top places */</p>
<p class="p1"><span class="Apple-converted-space">    </span>tbody tr.top1 { background: linear-gradient(90deg, rgba(255,215,0,0.08), transparent); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>tbody tr.top2 { background: linear-gradient(90deg, rgba(192,192,192,0.06), transparent); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>tbody tr.top3 { background: linear-gradient(90deg, rgba(205,127,50,0.06), transparent); }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>/* new row appearance */</p>
<p class="p1"><span class="Apple-converted-space">    </span>.new-row { opacity:0; transform: translateY(-8px); }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>@media (max-width:760px){</p>
<p class="p1"><span class="Apple-converted-space">      </span>.competitor{min-width:100px}</p>
<p class="p1"><span class="Apple-converted-space">      </span>.score{width:80px}</p>
<p class="p1"><span class="Apple-converted-space">      </span>thead th, tbody td { padding:8px; }</p>
<p class="p1"><span class="Apple-converted-space">      </span>.pos{width:44px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div class="leaderboard" aria-live="polite"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;h2&gt;Live Ranking&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;table id="board" role="table" aria-label="Live ranking table"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;thead&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;tr id="headerRow"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;th class="pos"&gt;#&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;th class="competitor"&gt;Competitor&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;!-- categories will be injected here --&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;th class="score"&gt;Total&lt;/th&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/tr&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/thead&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;tbody&gt;&lt;/tbody&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/table&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;script&gt;</p>
<p class="p1">/* ================= USER SETTINGS ================= */</p>
<p class="p1">const SHEET_ID = "1H7pI6CWOnP6QedIxfdFLRO_8DkswdLTc7v5rSu0TvNA";</p>
<p class="p1">const API_KEY<span class="Apple-converted-space">  </span>= "AIzaSyBGFkhdQZ3le5u_dI-fsmDMoD1VMPkQXEE";</p>
<p class="p1">const RANGE<span class="Apple-converted-space">    </span>= "Live!A1:K100";<span class="Apple-converted-space">      </span>// includes header row</p>
<p class="p1">const POLL_MS<span class="Apple-converted-space">  </span>= 8000;<span class="Apple-converted-space">                </span>// refresh interval in ms</p>
<p class="p1">/* ================================================= */</p>
<p class="p2"><br></p>
<p class="p1">const URL = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${encodeURIComponent(RANGE)}?key=${API_KEY}`;</p>
<p class="p2"><br></p>
<p class="p1">const tbody = document.querySelector('#board tbody');</p>
<p class="p1">const headerRow = document.getElementById('headerRow');</p>
<p class="p2"><br></p>
<p class="p1">let rowElements = new Map(); // id -&gt; tr element</p>
<p class="p1">let previousOrder = [];<span class="Apple-converted-space">      </span>// array of ids</p>
<p class="p1">let previousRanks = {};<span class="Apple-converted-space">      </span>// id -&gt; position</p>
<p class="p2"><br></p>
<p class="p1">// Utility to create/update a table row element for a competitor</p>
<p class="p1">function createRowElement(id, rowArray) {</p>
<p class="p1"><span class="Apple-converted-space">  </span>const tr = document.createElement('tr');</p>
<p class="p1"><span class="Apple-converted-space">  </span>tr.dataset.id = id;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// build cells (we expect rowArray indices: 0=A, 1=Name, 2..9 values, 10=Total)</p>
<p class="p1"><span class="Apple-converted-space">  </span>const name = rowArray[1] || "";</p>
<p class="p1"><span class="Apple-converted-space">  </span>const vals = [];</p>
<p class="p1"><span class="Apple-converted-space">  </span>for(let i=2;i&lt;=9;i++) vals.push(rowArray[i] || "");</p>
<p class="p1"><span class="Apple-converted-space">  </span>const total = rowArray[10] || "";</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>tr.innerHTML = `</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;td class="pos" aria-label="position"&gt;&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;td class="competitor" aria-label="competitor"&gt;${escapeHtml(name)}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>${vals.map(v=&gt;`&lt;td aria-label="value"&gt;${escapeHtml(v)}&lt;/td&gt;`).join('')}</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;td class="score" aria-label="total"&gt;${escapeHtml(total)}&lt;/td&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>`;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>return tr;</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function updateRowElement(tr, rowArray) {</p>
<p class="p1"><span class="Apple-converted-space">  </span>// update the cells' innerText; assumes same column structure</p>
<p class="p1"><span class="Apple-converted-space">  </span>const name = rowArray[1] || "";</p>
<p class="p1"><span class="Apple-converted-space">  </span>const total = rowArray[10] || "";</p>
<p class="p1"><span class="Apple-converted-space">  </span>// competitor (cell index 1)</p>
<p class="p1"><span class="Apple-converted-space">  </span>const cells = tr.children;</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(cells[1]) cells[1].textContent = name;</p>
<p class="p1"><span class="Apple-converted-space">  </span>// values C-J -&gt; tds 2..9</p>
<p class="p1"><span class="Apple-converted-space">  </span>for(let i=2;i&lt;=9;i++){</p>
<p class="p1"><span class="Apple-converted-space">    </span>const cell = cells[i];</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(cell) cell.textContent = rowArray[i] || "";</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>// total at last cell (index 10)</p>
<p class="p1"><span class="Apple-converted-space">  </span>const totalCell = cells[cells.length-1];</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(totalCell) totalCell.textContent = total;</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function escapeHtml(s){</p>
<p class="p1"><span class="Apple-converted-space">  </span>return String(s).replace(/&amp;/g,"&amp;amp;").replace(/&lt;/g,"&amp;lt;").replace(/&gt;/g,"&amp;gt;");</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// main rendering using FLIP animation</p>
<p class="p1">function renderWithAnimation(header, rows) {</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(!header || header.length === 0) return;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Build header (columns C-J are categories, indexes 2..9), rebuild headerRow content</p>
<p class="p1"><span class="Apple-converted-space">  </span>let headerHtml = `&lt;th class="pos"&gt;#&lt;/th&gt;&lt;th class="competitor"&gt;${escapeHtml(header[1] || 'Competitor')}&lt;/th&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>for(let i=2;i&lt;=9;i++){</p>
<p class="p1"><span class="Apple-converted-space">    </span>headerHtml += `&lt;th&gt;${escapeHtml(header[i] || '')}&lt;/th&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>headerHtml += `&lt;th class="score"&gt;${escapeHtml(header[10] || 'Total')}&lt;/th&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>headerRow.innerHTML = headerHtml;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Sort rows by total (col index 10). Ensure numeric compare.</p>
<p class="p1"><span class="Apple-converted-space">  </span>rows.sort((a,b)=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">    </span>const ta = Number((a &amp;&amp; a[10])||0);</p>
<p class="p1"><span class="Apple-converted-space">    </span>const tb = Number((b &amp;&amp; b[10])||0);</p>
<p class="p1"><span class="Apple-converted-space">    </span>return tb - ta;</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>const newOrder = rows.map((r,idx)=&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>// id = competitor name (col index 1); fallback unique id if empty</p>
<p class="p1"><span class="Apple-converted-space">    </span>const idRaw = (r &amp;&amp; r[1]) ? String(r[1]).trim() : null;</p>
<p class="p1"><span class="Apple-converted-space">    </span>return idRaw &amp;&amp; idRaw.length ? idRaw : `__row_${idx}_${Date.now()}`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Map id -&gt; row data</p>
<p class="p1"><span class="Apple-converted-space">  </span>const rowsById = {};</p>
<p class="p1"><span class="Apple-converted-space">  </span>rows.forEach((r, idx) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const id = newOrder[idx];</p>
<p class="p1"><span class="Apple-converted-space">    </span>rowsById[id] = r;</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// detect removals</p>
<p class="p1"><span class="Apple-converted-space">  </span>const removed = previousOrder.filter(id =&gt; !newOrder.includes(id));</p>
<p class="p1"><span class="Apple-converted-space">  </span>// animate removal</p>
<p class="p1"><span class="Apple-converted-space">  </span>removed.forEach(id =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const tr = rowElements.get(id);</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(!tr) return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>tr.style.transition = 'transform 350ms ease, opacity 350ms ease, height 350ms ease';</p>
<p class="p1"><span class="Apple-converted-space">    </span>tr.style.transform = 'translateY(-10px)';</p>
<p class="p1"><span class="Apple-converted-space">    </span>tr.style.opacity = '0';</p>
<p class="p1"><span class="Apple-converted-space">    </span>// remove after transition</p>
<p class="p1"><span class="Apple-converted-space">    </span>setTimeout(()=&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>if(tr.parentElement) tr.parentElement.removeChild(tr);</p>
<p class="p1"><span class="Apple-converted-space">      </span>rowElements.delete(id);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}, 360);</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Save initial positions (first)</p>
<p class="p1"><span class="Apple-converted-space">  </span>const firstRects = new Map();</p>
<p class="p1"><span class="Apple-converted-space">  </span>rowElements.forEach((el, id) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const r = el.getBoundingClientRect();</p>
<p class="p1"><span class="Apple-converted-space">    </span>firstRects.set(id, r);</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Append/create elements in new order (DOM reflow happens)</p>
<p class="p1"><span class="Apple-converted-space">  </span>newOrder.forEach((id, idx) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const rowData = rowsById[id] || [];</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(rowElements.has(id)){</p>
<p class="p1"><span class="Apple-converted-space">      </span>// existing element: update its content and move to new position</p>
<p class="p1"><span class="Apple-converted-space">      </span>const el = rowElements.get(id);</p>
<p class="p1"><span class="Apple-converted-space">      </span>updateRowElement(el, rowData);</p>
<p class="p1"><span class="Apple-converted-space">      </span>tbody.appendChild(el); // moves element to new spot</p>
<p class="p1"><span class="Apple-converted-space">    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">      </span>// new element: create and append</p>
<p class="p1"><span class="Apple-converted-space">      </span>const el = createRowElement(id, rowData);</p>
<p class="p1"><span class="Apple-converted-space">      </span>el.classList.add('new-row');</p>
<p class="p1"><span class="Apple-converted-space">      </span>// set invisible state; will animate in below</p>
<p class="p1"><span class="Apple-converted-space">      </span>el.style.opacity = '0';</p>
<p class="p1"><span class="Apple-converted-space">      </span>el.style.transform = 'translateY(-10px)';</p>
<p class="p1"><span class="Apple-converted-space">      </span>tbody.appendChild(el);</p>
<p class="p1"><span class="Apple-converted-space">      </span>rowElements.set(id, el);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// After DOM updated, measure last rects</p>
<p class="p1"><span class="Apple-converted-space">  </span>const lastRects = new Map();</p>
<p class="p1"><span class="Apple-converted-space">  </span>rowElements.forEach((el, id) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>lastRects.set(id, el.getBoundingClientRect());</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Apply FLIP: for elements that existed before, animate from old -&gt; new</p>
<p class="p1"><span class="Apple-converted-space">  </span>rowElements.forEach((el, id) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>// if element was removed earlier we already removed - skip if not in lastRects</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(!lastRects.has(id)) return;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>const first = firstRects.get(id);</p>
<p class="p1"><span class="Apple-converted-space">    </span>const last = lastRects.get(id);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// clear previous inline transitions so measurement is accurate</p>
<p class="p1"><span class="Apple-converted-space">    </span>el.style.transition = 'none';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>if(first){</p>
<p class="p1"><span class="Apple-converted-space">      </span>const deltaY = first.top - last.top;</p>
<p class="p1"><span class="Apple-converted-space">      </span>if(Math.abs(deltaY) &gt; 0.5){</p>
<p class="p1"><span class="Apple-converted-space">        </span>// invert</p>
<p class="p1"><span class="Apple-converted-space">        </span>el.style.transform = `translateY(${deltaY}px)`;</p>
<p class="p1"><span class="Apple-converted-space">        </span>el.style.opacity = '1';</p>
<p class="p1"><span class="Apple-converted-space">        </span>// play</p>
<p class="p1"><span class="Apple-converted-space">        </span>requestAnimationFrame(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">          </span>el.style.transition = 'transform 600ms cubic-bezier(.2,.8,.2,1)';</p>
<p class="p1"><span class="Apple-converted-space">          </span>el.style.transform = 'translateY(0)';</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p1"><span class="Apple-converted-space">      </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">        </span>// tiny/no movement: ensure no leftover transforms</p>
<p class="p1"><span class="Apple-converted-space">        </span>el.style.transform = '';</p>
<p class="p1"><span class="Apple-converted-space">        </span>el.style.opacity = '1';</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">      </span>// new element: animate in</p>
<p class="p1"><span class="Apple-converted-space">      </span>requestAnimationFrame(()=&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>el.style.transition = 'transform 600ms cubic-bezier(.2,.8,.2,1), opacity 600ms';</p>
<p class="p1"><span class="Apple-converted-space">        </span>el.style.transform = 'translateY(0)';</p>
<p class="p1"><span class="Apple-converted-space">        </span>el.style.opacity = '1';</p>
<p class="p1"><span class="Apple-converted-space">        </span>el.classList.remove('new-row');</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Clean up transform after transition end</p>
<p class="p1"><span class="Apple-converted-space">    </span>const onTransitionEnd = (ev) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>if(ev.propertyName === 'transform'){</p>
<p class="p1"><span class="Apple-converted-space">        </span>el.style.transition = '';</p>
<p class="p1"><span class="Apple-converted-space">        </span>el.style.transform = '';</p>
<p class="p1"><span class="Apple-converted-space">        </span>el.removeEventListener('transitionend', onTransitionEnd);</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>};</p>
<p class="p1"><span class="Apple-converted-space">    </span>el.addEventListener('transitionend', onTransitionEnd);</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Update top1/2/3 classes and rank change highlights</p>
<p class="p1"><span class="Apple-converted-space">  </span>const newRanks = {};</p>
<p class="p1"><span class="Apple-converted-space">  </span>newOrder.forEach((id, idx) =&gt; newRanks[id] = idx+1);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// compute rank-changes and apply temporary classes</p>
<p class="p1"><span class="Apple-converted-space">  </span>newOrder.forEach((id, idx) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const pos = idx+1;</p>
<p class="p1"><span class="Apple-converted-space">    </span>const el = rowElements.get(id);</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(!el) return;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// clear old highlight classes</p>
<p class="p1"><span class="Apple-converted-space">    </span>el.classList.remove('rank-up','rank-down','top1','top2','top3');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// top 3 classes</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(pos === 1) el.classList.add('top1');</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(pos === 2) el.classList.add('top2');</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(pos === 3) el.classList.add('top3');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>const old = previousRanks[id];</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(old !== undefined &amp;&amp; old !== pos) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>if(old &gt; pos) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>el.classList.add('rank-up');</p>
<p class="p1"><span class="Apple-converted-space">        </span>// remove after 1s</p>
<p class="p1"><span class="Apple-converted-space">        </span>setTimeout(()=&gt; el.classList.remove('rank-up'), 1200);</p>
<p class="p1"><span class="Apple-converted-space">      </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">        </span>el.classList.add('rank-down');</p>
<p class="p1"><span class="Apple-converted-space">        </span>setTimeout(()=&gt; el.classList.remove('rank-down'), 1200);</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>// set position cell</p>
<p class="p1"><span class="Apple-converted-space">    </span>const posCell = el.querySelector('.pos');</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(posCell) posCell.textContent = pos;</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// store for next update</p>
<p class="p1"><span class="Apple-converted-space">  </span>previousOrder = newOrder.slice();</p>
<p class="p1"><span class="Apple-converted-space">  </span>previousRanks = Object.assign({}, newRanks);</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// Fetching sheet values</p>
<p class="p1">async function fetchSheetValues() {</p>
<p class="p1"><span class="Apple-converted-space">  </span>const res = await fetch(URL, {cache: "no-store"});</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(!res.ok) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>throw new Error(`Fetch error ${res.status}: ${res.statusText}`);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>const json = await res.json();</p>
<p class="p1"><span class="Apple-converted-space">  </span>return json.values || [];</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">let isRefreshing = false;</p>
<p class="p1">async function refresh() {</p>
<p class="p1"><span class="Apple-converted-space">  </span>if(isRefreshing) return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>isRefreshing = true;</p>
<p class="p1"><span class="Apple-converted-space">  </span>try {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const values = await fetchSheetValues();</p>
<p class="p1"><span class="Apple-converted-space">    </span>if(values.length &lt;= 1){</p>
<p class="p1"><span class="Apple-converted-space">      </span>// no data or only header</p>
<p class="p1"><span class="Apple-converted-space">      </span>console.warn("No data in sheet");</p>
<p class="p1"><span class="Apple-converted-space">      </span>isRefreshing = false;</p>
<p class="p1"><span class="Apple-converted-space">      </span>return;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>const header = values[0];</p>
<p class="p1"><span class="Apple-converted-space">    </span>const rows = values.slice(1);</p>
<p class="p1"><span class="Apple-converted-space">    </span>renderWithAnimation(header, rows);</p>
<p class="p1"><span class="Apple-converted-space">  </span>} catch(err) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>console.error("Refresh error", err);</p>
<p class="p1"><span class="Apple-converted-space">  </span>} finally {</p>
<p class="p1"><span class="Apple-converted-space">    </span>isRefreshing = false;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// initial load and polling</p>
<p class="p1">refresh();</p>
<p class="p1">setInterval(refresh, POLL_MS);</p>
<p class="p1">&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
